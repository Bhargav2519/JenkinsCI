FROM mcr.microsoft.com/dotnet/sdk:7.0-alpine AS build-env

# Install Git
RUN apk add --no-cache git

# Set the working directory
WORKDIR /app

# Clone the Git repository
ARG PARAM1=default_value
ARG PARAM2=default_value
RUN git clone --branch ${PARAM2} --single-branch "${PARAM1}" .

# Set the working directory to the cloned repository
RUN mkdir /opt/dotnet1
RUN mv /app/eShopOnWeb* /opt/dotnet1
WORKDIR /opt/dotnet1/eShopOnWeb/


# Restore dependencies, build the application, and run unit tests
#RUN dotnet publish MSBuild.sln -c Release -o out
#RUN dotnet restore
RUN dotnet build eShopOnWeb.sln -c Release -o out
RUN dotnet test tests/UnitTests/UnitTests.csproj -c Release -o out
